#!/bin/sh

# Pre-push hook that runs tests and build validation
# This prevents pushing code that doesn't pass tests or build

echo "ðŸ”„ Running pre-push validation..."

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Function to print colored output
print_status() {
    echo "${GREEN}âœ… $1${NC}"
}

print_error() {
    echo "${RED}âŒ $1${NC}"
}

print_warning() {
    echo "${YELLOW}âš ï¸  $1${NC}"
}

# Check if we're in the right directory
if [ ! -f "package.json" ]; then
    print_error "package.json not found. Are you in the project root?"
    exit 1
fi

print_status "Running TypeScript compilation check..."
if ! npm run build > /dev/null 2>&1; then
    print_error "TypeScript compilation failed!"
    echo "Please fix compilation errors before pushing."
    npm run build
    exit 1
fi
print_status "TypeScript compilation passed"

print_status "Running linter..."
if ! npm run lint > /dev/null 2>&1; then
    print_error "Linting failed!"
    echo "Please fix linting errors before pushing."
    npm run lint
    exit 1
fi
print_status "Linting passed"

print_status "Running tests..."
if ! npm test > /dev/null 2>&1; then
    print_error "Tests failed!"
    echo "Please fix failing tests before pushing."
    npm test
    exit 1
fi
print_status "All tests passed"

print_status "All validation checks passed! ðŸš€"
echo "Pushing to remote..."

exit 0